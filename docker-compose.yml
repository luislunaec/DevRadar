# DevRadar - Docker Compose para VPS
# Levantar: docker compose up -d backend frontend

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    env_file:
      - .env
    volumes:
      # Backend y scraper leen .env desde la raíz del proyecto → /app
      - ./.env:/app/.env:ro
    ports:
      - "8000:8000"
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        # URL pública del API (build-time para Vite). En deploy usar PUBLIC_API_URL.
        VITE_API_URL: ${PUBLIC_API_URL:-http://217.216.89.228:8000/api}
    ports:
      - "8080:8080"
    depends_on:
      - backend
    restart: unless-stopped

  scraper:
    build:
      context: ./scraper
      dockerfile: Dockerfile
    env_file:
      - .env
    volumes:
      - ./.env:/app/.env:ro
    working_dir: /app/scraper
    # Ejecución manual: docker compose run --rm scraper [días]
    restart: "no"
